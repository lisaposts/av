<section id="offers" class="ava-section ava-offers">
  <div class="ava-container">
    <h2 class="ava-section__title">{{ section.settings.heading }}</h2>
    <p class="ava-section__subtitle">{{ section.settings.subheading }}</p>

    <div class="ava-offers__grid">
      {%- for block in section.blocks -%}
        {%- assign product = all_products[block.settings.product_handle] -%}
        <article class="ava-card ava-offer" {{ block.shopify_attributes }}>
          <h3 class="ava-card__title">
            {%- if product -%}
              {{ product.title }}
            {%- else -%}
              {{ block.settings.fallback_title }}
            {%- endif -%}
          </h3>
          <p class="ava-card__text">
            {%- if block.settings.description != blank -%}
              {{ block.settings.description }}
            {%- elsif product and product.description != blank -%}
              {{ product.description | strip_html | truncate: 140 }}
            {%- endif -%}
          </p>
          {%- if product -%}
            <p class="ava-offer__price">
              {{ product.price | money }}
            </p>
            <a href="{{ product.url }}" class="ava-btn ava-btn--primary">
              {{ block.settings.button_label | default: 'View lesson' }}
            </a>
          {%- endif -%}
        </article>
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Ava Verve – Offers",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Pick your first lesson"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Start with a single playbook or grab a bundle that matches your niche."
    }
  ],
  "blocks": [
    {
      "type": "offer",
      "name": "Offer",
      "settings": [
        {
          "type": "product",
          "id": "product_handle",
          "label": "Product"
        },
        {
          "type": "text",
          "id": "fallback_title",
          "label": "Fallback title (if product missing)",
          "default": "AI Content Playbook"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Custom description (optional)"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button label",
          "default": "View lesson"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ava Verve – Offers",
      "category": "Ava Verve",
      "blocks": [
        { "type": "offer" },
        { "type": "offer" },
        { "type": "offer" }
      ]
    }
  ]
}
{% endschema %}
